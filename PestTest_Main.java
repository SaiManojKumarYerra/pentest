package com.ariqt;

import org.openqa.selenium.Proxy;
import org.openqa.selenium.WebDriver;
import org.openqa.selenium.chrome.ChromeDriver;
import org.openqa.selenium.chrome.ChromeOptions;
import org.testng.Assert;
import org.zaproxy.clientapi.core.ApiResponse;
import org.zaproxy.clientapi.core.ClientApi;
import org.zaproxy.clientapi.core.ClientApiException;

public class PestTest_Main {
	static final String ZAP_PROXY_ADDRESS = "localhost";
	static final int ZAP_PROXY_PORT = 8081;
	static final String ZAP_API_KEY = "ebjilatemfdl6lfh3eqgm3983b";
	
	public static WebDriver driver;
	public static ClientApi api;
	public static void main(String[] args) {
		
String proxyServerUrl = ZAP_PROXY_ADDRESS+":"+ZAP_PROXY_PORT;
		
		Proxy proxy = new Proxy();
		
		proxy.setHttpProxy(proxyServerUrl);
		proxy.setSslProxy(proxyServerUrl);
		
		
		ChromeOptions options = new ChromeOptions();
		options.setAcceptInsecureCerts(true);
		options.setProxy(proxy);
		

			driver = new ChromeDriver(options);

		
		api = new ClientApi(ZAP_PROXY_ADDRESS, ZAP_PROXY_PORT, ZAP_API_KEY);
		
		driver.get("https://www.ariqt.com/");
		Assert.assertTrue(driver.getTitle().trim().equals("Ariqt International"));
		
		if(api!=null) {
			String title = "Ariqt ZAP Pen Test Report";
			String template = "traditional-html";
			String description = "Penetration Testing Report of Ariqt Website";
			String reportFileName = "ariqt-pen-test-report.html";
			String targetFolder = System.getProperty("user.dir");
			
			try {
				ApiResponse response = api.reports.generate(title, template, null, description, null, null, null, null, null, reportFileName, null, targetFolder, null);
				System.out.println("ZAP report has been created here : "+response.toString());
			} catch (ClientApiException e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
		}
		driver.quit();
	}

}
